$ bun test
bun test v1.2.20 (6ad208bc)

src/__tests__/rate-limit.test.ts:
(pass) Rate limiting security > isTrustProxyEnabled > should return false by default [0.04ms]
(pass) Rate limiting security > isTrustProxyEnabled > should return false for empty string
(pass) Rate limiting security > isTrustProxyEnabled > should return false for 'false'
(pass) Rate limiting security > isTrustProxyEnabled > should return true only for 'true'
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should ignore X-Forwarded-For header (not treated as client identity) [6.50ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should ignore X-Real-IP header (not treated as client identity) [0.75ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should NOT allow shared bucket DoS (security fix) [0.72ms]
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should use X-Forwarded-For header for rate limiting [0.50ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should reject malformed X-Forwarded-For values [0.41ms]
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should take first IP from X-Forwarded-For chain [0.64ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > rate limit headers > should include rate limit headers in response [0.32ms]
(pass) Rate limiting security > rate limit headers > should include Retry-After header when rate limited [0.27ms]

src/__tests__/health.test.ts:
(pass) Health endpoint security > when auth is disabled > should return database path in /health response [0.62ms]
(pass) Health endpoint security > when auth is enabled > should NOT return database path for unauthenticated requests [0.30ms]
(pass) Health endpoint security > when auth is enabled > should NOT return database path with invalid API key [0.26ms]
(pass) Health endpoint security > when auth is enabled > should return database path with valid X-Api-Key header [0.20ms]
(pass) Health endpoint security > when auth is enabled > should return database path with valid Bearer token [0.16ms]
(pass) isRequestAuthenticated > should treat all requests as authenticated when auth is disabled [0.19ms]

dist/__tests__/rate-limit.test.js:
(pass) Rate limiting security > isTrustProxyEnabled > should return false by default [0.02ms]
(pass) Rate limiting security > isTrustProxyEnabled > should return false for empty string [0.56ms]
(pass) Rate limiting security > isTrustProxyEnabled > should return false for 'false'
(pass) Rate limiting security > isTrustProxyEnabled > should return true only for 'true' [0.02ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should ignore X-Forwarded-For header (not treated as client identity) [0.76ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should ignore X-Real-IP header (not treated as client identity) [0.39ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY is NOT set (secure default) > should NOT allow shared bucket DoS (security fix) [0.31ms]
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should use X-Forwarded-For header for rate limiting [0.14ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should reject malformed X-Forwarded-For values [0.22ms]
(pass) Rate limiting security > when TX_API_TRUST_PROXY=true > should take first IP from X-Forwarded-For chain [0.05ms]
[rate-limit] Unable to identify client IP - rate limiting degraded for this request. Ensure your server runtime exposes socket info or configure a trusted reverse proxy.
(pass) Rate limiting security > rate limit headers > should include rate limit headers in response [0.14ms]
(pass) Rate limiting security > rate limit headers > should include Retry-After header when rate limited [0.06ms]

dist/__tests__/health.test.js:
(pass) Health endpoint security > when auth is disabled > should return database path in /health response [0.32ms]
(pass) Health endpoint security > when auth is enabled > should NOT return database path for unauthenticated requests [0.18ms]
(pass) Health endpoint security > when auth is enabled > should NOT return database path with invalid API key [0.17ms]
(pass) Health endpoint security > when auth is enabled > should return database path with valid X-Api-Key header [0.14ms]
(pass) Health endpoint security > when auth is enabled > should return database path with valid Bearer token [0.17ms]
(pass) isRequestAuthenticated > should treat all requests as authenticated when auth is disabled [0.11ms]

 36 pass
 0 fail
 86 expect() calls
Ran 36 tests across 4 files. [127.00ms]
