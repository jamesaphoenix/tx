$ bun test
bun test v1.2.20 (6ad208bc)

src/__tests__/auth.test.ts:
(pass) isAuthEnabled > should return false when TX_API_KEY is not set [0.03ms]
(pass) isAuthEnabled > should return false when TX_API_KEY is empty string
(pass) isAuthEnabled > should return true when TX_API_KEY is set
(pass) isAuthEnabled > should return true for any non-empty TX_API_KEY value
(pass) extractApiKey > should extract X-Api-Key header [0.33ms]
(pass) extractApiKey > should extract Bearer token from Authorization header
(pass) extractApiKey > should prefer X-Api-Key over Authorization header
(pass) extractApiKey > should return null when no auth headers present
(pass) extractApiKey > should return null for non-Bearer Authorization header [0.28ms]
(pass) extractApiKey > should return null for empty Authorization header [0.02ms]
(pass) extractApiKey > should handle undefined header values
(pass) extractApiKey > should extract Bearer token with spaces in the token [0.06ms]
(pass) timingSafeEqual > should return true for equal strings [0.23ms]
(pass) timingSafeEqual > should return false for different strings of same length [12.41ms]
(pass) timingSafeEqual > should return false for different strings of different length [0.06ms]
(pass) timingSafeEqual > should return true for empty strings [0.02ms]
(pass) timingSafeEqual > should return false when one string is empty [0.01ms]
(pass) timingSafeEqual > should handle unicode characters [0.02ms]
(pass) timingSafeEqual > should handle long strings [0.15ms]
(pass) authMiddleware > should export authMiddleware as a function [0.04ms]
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is disabled (no TX_API_KEY) [0.02ms]
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is disabled even with a key header [0.03ms]
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is enabled but no key provided [0.02ms]
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is enabled but wrong key provided [0.02ms]
(pass) sensitive info disclosure prevention > should expose sensitive info when auth is enabled and correct key provided
(pass) sensitive info disclosure prevention > should expose sensitive info when auth is enabled and correct Bearer token provided [0.02ms]

src/__tests__/body-limit.test.ts:
(pass) body limit constants > should define DEFAULT_MAX_BYTES as 1MB [0.05ms]
(pass) body limit constants > should define SYNC_MAX_BYTES as 10MB
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/export [0.05ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/import [0.02ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/status
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/compact
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/tasks
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/learnings [0.04ms]
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/runs [0.03ms]
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /health
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for root path
(pass) bodyLimitMiddleware > should export bodyLimitMiddleware as a function

src/__tests__/server-lib.test.ts:
(pass) Server auth configuration > should detect auth enabled via TX_API_KEY
(pass) Server auth configuration > should detect auth disabled when TX_API_KEY not set
(pass) Server auth configuration > should detect auth disabled for empty TX_API_KEY [0.02ms]
(pass) CORS configuration > should default to localhost origins when TX_API_CORS_ORIGIN is not set
(pass) CORS configuration > should allow wildcard only when explicitly set to *
(pass) CORS configuration > should parse comma-separated origins
(pass) CORS configuration > should handle single custom origin [0.15ms]
(pass) CORS configuration > should enable credentials when TX_API_CORS_CREDENTIALS is true [0.02ms]
(pass) CORS configuration > should disable credentials by default [0.01ms]
(pass) API definition exports > should export TxApi class from api.ts [44.56ms]
(pass) API definition exports > should export all error types from api.ts [0.07ms]
(pass) API definition exports > should export mapCoreError from api.ts
(pass) API definition exports > should export all API groups from api.ts

src/__tests__/api.test.ts:
(pass) Error types > should create NotFound with message
(pass) Error types > should create BadRequest with message [0.04ms]
(pass) Error types > should create InternalError with message
(pass) Error types > should create Unauthorized with message
(pass) Error types > should create Forbidden with message
(pass) Error types > should create ServiceUnavailable with message
(pass) mapCoreError > maps not-found errors to NotFound > should map TaskNotFoundError [0.20ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map LearningNotFoundError [0.01ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map FileLearningNotFoundError
(pass) mapCoreError > maps not-found errors to NotFound > should map AttemptNotFoundError [1.11ms]
(pass) mapCoreError > maps validation errors to BadRequest > should map ValidationError [0.02ms]
(pass) mapCoreError > maps validation errors to BadRequest > should map CircularDependencyError
(pass) mapCoreError > maps service errors to ServiceUnavailable > should map EmbeddingUnavailableError
(pass) mapCoreError > maps database and unknown tagged errors to InternalError > should map DatabaseError
(pass) mapCoreError > maps database and unknown tagged errors to InternalError > should map unknown tagged errors to InternalError
(pass) mapCoreError > handles non-tagged errors > should map string errors to InternalError
(pass) mapCoreError > handles non-tagged errors > should map Error objects to InternalError [0.15ms]
(pass) mapCoreError > handles non-tagged errors > should map null to InternalError [0.02ms]
(pass) mapCoreError > handles non-tagged errors > should map undefined to InternalError
(pass) mapCoreError > handles non-tagged errors > should use _tag as message when no message field present [0.03ms]
(pass) API structure > should export TxApi class
(pass) API structure > should export all groups [0.02ms]

dist/__tests__/server-lib.test.js:
(pass) Server auth configuration > should detect auth enabled via TX_API_KEY
(pass) Server auth configuration > should detect auth disabled when TX_API_KEY not set
(pass) Server auth configuration > should detect auth disabled for empty TX_API_KEY [0.01ms]
(pass) CORS configuration > should default to localhost origins when TX_API_CORS_ORIGIN is not set [0.02ms]
(pass) CORS configuration > should allow wildcard only when explicitly set to *
(pass) CORS configuration > should parse comma-separated origins [0.01ms]
(pass) CORS configuration > should handle single custom origin [0.01ms]
(pass) CORS configuration > should enable credentials when TX_API_CORS_CREDENTIALS is true
(pass) CORS configuration > should disable credentials by default
(pass) API definition exports > should export TxApi class from api.ts [4.71ms]
(pass) API definition exports > should export all error types from api.ts
(pass) API definition exports > should export mapCoreError from api.ts
(pass) API definition exports > should export all API groups from api.ts

dist/__tests__/api.test.js:
(pass) Error types > should create NotFound with message [0.10ms]
(pass) Error types > should create BadRequest with message [0.06ms]
(pass) Error types > should create InternalError with message [1.66ms]
(pass) Error types > should create Unauthorized with message [0.05ms]
(pass) Error types > should create Forbidden with message [0.08ms]
(pass) Error types > should create ServiceUnavailable with message [0.03ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map TaskNotFoundError [0.07ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map LearningNotFoundError [0.01ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map FileLearningNotFoundError [0.02ms]
(pass) mapCoreError > maps not-found errors to NotFound > should map AttemptNotFoundError [0.01ms]
(pass) mapCoreError > maps validation errors to BadRequest > should map ValidationError [0.04ms]
(pass) mapCoreError > maps validation errors to BadRequest > should map CircularDependencyError [0.01ms]
(pass) mapCoreError > maps service errors to ServiceUnavailable > should map EmbeddingUnavailableError [0.05ms]
(pass) mapCoreError > maps database and unknown tagged errors to InternalError > should map DatabaseError [0.04ms]
(pass) mapCoreError > maps database and unknown tagged errors to InternalError > should map unknown tagged errors to InternalError [0.03ms]
(pass) mapCoreError > handles non-tagged errors > should map string errors to InternalError [0.02ms]
(pass) mapCoreError > handles non-tagged errors > should map Error objects to InternalError [0.08ms]
(pass) mapCoreError > handles non-tagged errors > should map null to InternalError [0.16ms]
(pass) mapCoreError > handles non-tagged errors > should map undefined to InternalError [0.06ms]
(pass) mapCoreError > handles non-tagged errors > should use _tag as message when no message field present [0.03ms]
(pass) API structure > should export TxApi class
(pass) API structure > should export all groups [0.02ms]

dist/__tests__/auth.test.js:
(pass) isAuthEnabled > should return false when TX_API_KEY is not set
(pass) isAuthEnabled > should return false when TX_API_KEY is empty string
(pass) isAuthEnabled > should return true when TX_API_KEY is set [0.03ms]
(pass) isAuthEnabled > should return true for any non-empty TX_API_KEY value
(pass) extractApiKey > should extract X-Api-Key header [0.02ms]
(pass) extractApiKey > should extract Bearer token from Authorization header [0.01ms]
(pass) extractApiKey > should prefer X-Api-Key over Authorization header
(pass) extractApiKey > should return null when no auth headers present
(pass) extractApiKey > should return null for non-Bearer Authorization header
(pass) extractApiKey > should return null for empty Authorization header
(pass) extractApiKey > should handle undefined header values
(pass) extractApiKey > should extract Bearer token with spaces in the token
(pass) timingSafeEqual > should return true for equal strings [0.01ms]
(pass) timingSafeEqual > should return false for different strings of same length
(pass) timingSafeEqual > should return false for different strings of different length
(pass) timingSafeEqual > should return true for empty strings
(pass) timingSafeEqual > should return false when one string is empty [0.01ms]
(pass) timingSafeEqual > should handle unicode characters [0.93ms]
(pass) timingSafeEqual > should handle long strings [0.02ms]
(pass) authMiddleware > should export authMiddleware as a function
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is disabled (no TX_API_KEY)
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is disabled even with a key header
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is enabled but no key provided
(pass) sensitive info disclosure prevention > should NOT expose sensitive info when auth is enabled but wrong key provided
(pass) sensitive info disclosure prevention > should expose sensitive info when auth is enabled and correct key provided
(pass) sensitive info disclosure prevention > should expose sensitive info when auth is enabled and correct Bearer token provided

dist/__tests__/body-limit.test.js:
(pass) body limit constants > should define DEFAULT_MAX_BYTES as 1MB
(pass) body limit constants > should define SYNC_MAX_BYTES as 10MB [0.05ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/export [0.01ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/import [0.01ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/status [0.01ms]
(pass) getMaxBytes > should return SYNC_MAX_BYTES for /api/sync/compact
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/tasks
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/learnings [0.01ms]
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /api/runs
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for /health [0.01ms]
(pass) getMaxBytes > should return DEFAULT_MAX_BYTES for root path
(pass) bodyLimitMiddleware > should export bodyLimitMiddleware as a function [0.01ms]

 146 pass
 0 fail
 218 expect() calls
Ran 146 tests across 8 files. [769.00ms]
