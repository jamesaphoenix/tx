---
title: tx claim
description: Claim a task with a lease to prevent parallel collisions
---

## Purpose

`tx claim` marks a task as being actively worked on by a specific worker. This prevents multiple agents from picking the same task and duplicating work. Claims use a lease-based model with automatic expiry.

## Claim a Task

<Tabs groupId="interface" persist items={["CLI", "TypeScript SDK", "MCP", "REST API"]}>
<Tab value="CLI">

```bash
tx claim <task-id> <worker-id> [options]
```

### Arguments

| Argument | Required | Description |
|----------|----------|-------------|
| `<task-id>` | Yes | Task ID (e.g., `tx-a1b2c3d4`) |
| `<worker-id>` | Yes | Worker ID (e.g., `worker-abc12345`) |

### Options

| Option | Description |
|--------|-------------|
| `--lease <m>` | Lease duration in minutes (default: 30) |
| `--json` | Output as JSON |
| `--help` | Show help |

### Examples

```bash
# Claim with default 30-minute lease
tx claim tx-abc123 worker-def456

# Claim with 60-minute lease
tx claim tx-abc123 worker-def456 --lease 60

# JSON output
tx claim tx-abc123 worker-def456 --json
```

</Tab>
<Tab value="TypeScript SDK">

```typescript
import { ClaimService } from '@jamesaphoenix/tx-core'
import { Effect } from 'effect'

// Claims use the Effect-based ClaimService directly
const program = Effect.gen(function* () {
  const svc = yield* ClaimService

  // Claim a task with a 60-minute lease
  const claim = yield* svc.claim('tx-abc123', 'worker-1', 60)
  // Returns: { id, taskId, workerId, claimedAt, leaseExpiresAt, renewedCount, status }

  console.log(`Claimed until ${claim.leaseExpiresAt.toISOString()}`)
})
```

> **Note:** The TxClient SDK (`@jamesaphoenix/tx-agent-sdk`) does not yet have a `claims` namespace.
> Use the Effect-based `ClaimService` from `@jamesaphoenix/tx-core` for programmatic access.

</Tab>
<Tab value="MCP">

```json
{
  "tool": "tx_claim",
  "arguments": {
    "taskId": "tx-abc123",
    "workerId": "worker-1",
    "leaseDurationMinutes": 60
  }
}
```

</Tab>
<Tab value="REST API">

> **Note:** Claims are not yet exposed via REST API endpoints. Use the CLI or MCP interface for claim operations.

```bash
# Claims REST API is planned but not yet available.
# Use the CLI instead:
tx claim tx-abc123 worker-1 --lease 60
```

</Tab>
</Tabs>

## Release a Claim

Release a worker's claim on a task, allowing other workers to claim it.

<Tabs groupId="interface" persist items={["CLI", "TypeScript SDK", "MCP", "REST API"]}>
<Tab value="CLI">

```bash
tx claim:release <task-id> <worker-id> [options]
```

### Arguments

| Argument | Required | Description |
|----------|----------|-------------|
| `<task-id>` | Yes | Task ID |
| `<worker-id>` | Yes | Worker ID that holds the claim |

### Options

| Option | Description |
|--------|-------------|
| `--json` | Output as JSON |
| `--help` | Show help |

### Examples

```bash
tx claim:release tx-abc123 worker-def456
```

</Tab>
<Tab value="TypeScript SDK">

```typescript
import { ClaimService } from '@jamesaphoenix/tx-core'
import { Effect } from 'effect'

const program = Effect.gen(function* () {
  const svc = yield* ClaimService

  // Release a claim
  yield* svc.release('tx-abc123', 'worker-1')
})
```

</Tab>
<Tab value="MCP">

```json
{
  "tool": "tx_claim_release",
  "arguments": {
    "taskId": "tx-abc123",
    "workerId": "worker-1"
  }
}
```

</Tab>
<Tab value="REST API">

> **Note:** Claims are not yet exposed via REST API. Use the CLI instead:

```bash
tx claim:release tx-abc123 worker-1
```

</Tab>
</Tabs>

## Renew a Claim

Extend the lease on an existing claim. Use this for long-running tasks to prevent the claim from expiring.

<Tabs groupId="interface" persist items={["CLI", "TypeScript SDK", "MCP", "REST API"]}>
<Tab value="CLI">

```bash
tx claim:renew <task-id> <worker-id> [options]
```

### Arguments

| Argument | Required | Description |
|----------|----------|-------------|
| `<task-id>` | Yes | Task ID |
| `<worker-id>` | Yes | Worker ID that holds the claim |

### Options

| Option | Description |
|--------|-------------|
| `--json` | Output as JSON |
| `--help` | Show help |

### Limits

- Maximum 10 renewals per claim
- Fails if the lease has already expired
- Fails if no active claim exists for this task and worker

### Examples

```bash
tx claim:renew tx-abc123 worker-def456
```

</Tab>
<Tab value="TypeScript SDK">

```typescript
import { ClaimService } from '@jamesaphoenix/tx-core'
import { Effect } from 'effect'

const program = Effect.gen(function* () {
  const svc = yield* ClaimService

  // Renew a claim (extends the lease)
  const renewed = yield* svc.renew('tx-abc123', 'worker-1')
  console.log(`New expiry: ${renewed.leaseExpiresAt.toISOString()}`)
  console.log(`Renewals: ${renewed.renewedCount}/10`)
})
```

</Tab>
<Tab value="MCP">

```json
{
  "tool": "tx_claim_renew",
  "arguments": {
    "taskId": "tx-abc123",
    "workerId": "worker-1"
  }
}
```

</Tab>
<Tab value="REST API">

> **Note:** Claims are not yet exposed via REST API. Use the CLI instead:

```bash
tx claim:renew tx-abc123 worker-1
```

</Tab>
</Tabs>

## Use Case: Parallel Agent Execution

Without claims, parallel agents might pick the same task:

```bash
# Problem: Both agents pick the same task
Agent1: tx ready --limit 1  → tx-abc123
Agent2: tx ready --limit 1  → tx-abc123  # Same task!
```

With claims:

```bash
# Solution: Claims prevent collision
Agent1: tx claim tx-abc123 worker-1   # Success
Agent2: tx claim tx-abc123 worker-2   # Fails - already claimed
```

### Parallel Agent Loop

```bash
#!/bin/bash
WORKER_ID="worker-$$"

while true; do
  TASK=$(tx ready --json --limit 1 | jq -r '.[0].id // empty')
  [ -z "$TASK" ] && break

  # Try to claim - skip if another worker got it
  tx claim "$TASK" "$WORKER_ID" || continue

  # Work on the task
  claude "Your task is $TASK. Run 'tx show $TASK' for details."

  # Complete and release
  tx done "$TASK"
done
```

## Behavior

1. **Claiming** creates a lease with an expiry time
2. **Expired leases** allow other workers to claim the task
3. **Completing** a task (`tx done`) does not require releasing the claim first
4. **Long tasks** should periodically renew with `tx claim:renew`

## Related Commands

- [`tx ready`](/docs/primitives/ready) - List unclaimed ready tasks
- [`tx done`](/docs/primitives/done) - Complete a task
